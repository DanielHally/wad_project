
{% extends 'gsr/base.html' %}
{% load staticfiles %}
{% load gsr_template_tags %}

{% block title_block %}
   View Shop
{% endblock %}

{% block head_block %}
    <link href="{% static 'css/gsr/common.css' %}" rel="stylesheet" crossorigin="anonymous">
    <script src="{% static 'js/gsr/view_shop.js' %}" crossorigin="anonymous"></script>
{% endblock %}

{% block body_block %}
    {% if shop %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-4"></div>
            <div class = "col-md-2 gsr-blue d-inline-block">
                <h3>Categories</h3>
            </div>
            <div class="col-md-2 gsr-cream d-inline-block">
                {% for category in categories %}
                    <a class="category-link" category="{{ category }}">{{ category }}</a>
                    <br>
                {% endfor %}
            </div>
        </div>
        <br>
        <h1 class="text-center gsr-blue">{{ shop.name }}</h1>
        <h4 class="gsr-blue text-center card p-3 col-md-2">Description</h4>
        <div class="row">
            <div class="col-md-6 col-lg-9">
                <div class="card p-3 gsr-cream" style="height: 256px;">
                {{ shop.description }}
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card" style="height: 256px;background-size:100% 100%;background-image: url({% shop_picture shop %});"></div>
            </div>
        </div>
        <br /> <br /> <br />
        <div class="row">
            <div class="col-md-4">
                {% map_embed shop.location %}
            </div>
            <div class="col-sm-2"></div>
            <div class="col-md-8 col-lg-3">
                <h4 class="gsr-blue text-center card p-3">Opening Hours</h4>
                <div class="card p-3 gsr-cream text-center" style="height: 190px;">
                {% if shop.opening_hours %}
                {% for hours in shop.opening_hours %}
                    {{ hours }}
                    <br>
                {% endfor %}
                {% else %}
                    Not available
                {% endif %}
                </div>
            </div>
        </div>

        <br /> <br /> <br />
        <div class = "gsr-blue text-center card p-3 row">
            <div class="row">
                <div class="col-md-2">
                    <h4>Reviews</h4>
                </div>
                <div class="col-md-2">
                    <a href="{% url 'gsr:add_review' shop.slug %}" class="btn btn-warning">Leave a Review</a>
                </div>
            </div>
        </div>

        <div class="gsr-cream">
            {% for review in reviews %}
                <strong>{{ review.author }}</strong>
                <br />
                <strong>{{ review.date_added }}</strong>
                <br />
                {% if review.comment and review.comment.strip %}
                    {{ review.comment }}
                <br />
                {% endif %}
                {% star_rating review %}
                <button class="show-replies" data-review-id ="{{ review.id }}">Show replies</button>

                <button class="reply-button" data-review-id="{{ review.id }}">Reply</button>
                <div class="reply-form" id="reply-form-{{ review.id }}" style="display: none;">
                  <form class="reply_form" id="reply-form-{{ review.id }}">
                    {% csrf_token %}
                    comment:
                    <input id="comment-{{ review.id }}"></input>
                    <input type="hidden" name="review_id" value="{{ review.id }}">
                    <input class="btn btn-primary" type="submit" name="Reply" value="Reply" />
                  </form>
                </div>
                <div id="replies-section-{{ review.id }}" style="display: none;">

                </div>



                <br />
                <hr>
            {% endfor %}
        </div>

        {% else %}
        Shop doesn't exist
        {% endif %}
    </div>

{% endblock %}